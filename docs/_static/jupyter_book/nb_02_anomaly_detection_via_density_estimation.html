

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Anomaly Detection via Density Estimation &#8212; Practical Anomaly Detection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/configmacros"]}, "tex": {"packages": {"[+]": ["configmacros"]}, "macros": {"vect": ["{\\mathbf{\\boldsymbol{#1}} }", 1], "E": "{\\mathbb{E}}", "P": "{\\mathbb{P}}", "R": "{\\mathbb{R}}", "abs": ["{\\left| #1 \\right|}", 1], "simpl": ["{\\Delta^{#1} }", 1], "amax": "{\\text{argmax}}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nb_02_anomaly_detection_via_density_estimation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Anomaly Detection via Isolation" href="nb_03_anomaly_detection_via_isolation.html" />
    <link rel="prev" title="Taxonomy of Anomaly Detection Approaches" href="nb_01_1_intro_and_ad_taxonomy.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/transferlab-logo.svg" class="logo__image only-light" alt="Practical Anomaly Detection - Home"/>
    <script>document.write(`<img src="_static/transferlab-logo.svg" class="logo__image only-dark" alt="Practical Anomaly Detection - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    practical anomaly detection - Notebook Pages
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="nb_01_0_intro_anomaly_detection.html">Introduction to Anomaly Detection</a></li>





<li class="toctree-l1"><a class="reference internal" href="nb_01_1_intro_and_ad_taxonomy.html">Taxonomy of Anomaly Detection Approaches</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Anomaly Detection via Density Estimation</a></li>






<li class="toctree-l1"><a class="reference internal" href="nb_03_anomaly_detection_via_isolation.html">Anomaly Detection via Isolation</a></li>







<li class="toctree-l1"><a class="reference internal" href="nb_04_anomaly_detection_via_reconstruction.html">Anomaly Detection via Reconstruction Error</a></li>








<li class="toctree-l1"><a class="reference internal" href="nb_05_anomaly_detection_on_time_series.html">Anomaly Detection on Time Series</a></li>


<li class="toctree-l1"><a class="reference internal" href="nb_06_extreme_value_theory_for_anomaly_detection.html">Extreme Value Theory and Anomaly Detection</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/nb_02_anomaly_detection_via_density_estimation.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Anomaly Detection via Density Estimation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Anomaly Detection via Density Estimation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Anomaly Detection via Density Estimation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-density-estimation">Kernel Density Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-kde-parameters">Choose KDE Parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bandwidth-selection">Bandwidth Selection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-define-the-search-space-for-the-kernel-and-the-bandwidth">Exercise: Define the search space for the kernel and the bandwidth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-isolate-anomalies-in-house-prices">Exercise: Isolate anomalies in house prices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-curse-of-dimensionality">The Curse of Dimensionality</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robustness">Robustness</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-statistics">Robust Statistics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#huber-loss">Huber loss</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hampel-loss">Hampel loss</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kde-is-a-mean">KDE is a Mean</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementations">Implementations</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell tag_remove-input tag_remove-input-nbconv docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style>/*
This file is mainly copy-pasta from rise's examples
https://github.com/damianavila/RISE/blob/master/examples/rise.css
that was further customized for appliedAI purposes
*/
@import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@400&display=swap');


body {
    font-family: 'Work Sans', sans-serif !important;
    text-transform: initial !important;
    letter-spacing: initial !important;
    font-weight: 400 !important;
    line-height: 1.5 !important;
    text-size-adjust: 100% !important;
    ‑webkit‑text‑size‑adjust: 100% !important;
}


.reveal, div.text_cell_render, .md-slide, .sidebar-wrapper {
    font-size: 1.5rem !important;
}

.navbar-default .navbar-nav > li > a {
    color: #00747b !important;
}

.filename {
    font-size: 2.4rem !important;
    color: #212529 !important;
    font-weight: 600 !important;
}

.reveal, .md-slide {
    color: white !important;
}

h1, h2 {
    color: #00747b !important;
}

h3, h4, h5, h6 {
    color: #808080 !important;
}

.reveal p, .reveal ol, .reveal dl, .reveal ul,
div.text_cell_render {
    color: #212529 !important;
}

/*copied from stackoverflow, better spacing between list items*/
li + li {
  margin-top: 0.2em;
}

body.rise-enabled .reveal ol, body.rise-enabled .reveal dl, body.rise-enabled .reveal ul {
    margin-left: 0.1em;
    margin-top: 0.2em;
}

.reveal .rendered_html h1:first-child,
.reveal .rendered_html h2:first-child,
.reveal .rendered_html h3:first-child,
.reveal .rendered_html h4:first-child,
.reveal .rendered_html h5:first-child {
    margin-top: 0.2em;
}

.CodeMirror-lines, .output_text {
    font-size: 1.5rem !important;
}


h1.plan, h2.plan, h3.plan {
    text-align: center;
    padding-bottom: 30px;
}

ul.plan>li>span.plan-bold {
    font-size: 110%;
    padding: 4px;
    font-weight: bold;
    background-color: #eee;
}

ul.plan>li>ul.subplan>li>span.plan-bold {
    font-weight: bold;
}

.plan-strike {
    opacity: 0.4;
/*    text-decoration: line-through; */
}

div.plan-container {
    display: grid;
    grid-template-columns: 50% 50%;
}

/*
 * this is to void xarray's html output to show the fallback textual representation
 * see also
   * xarray.md and
   * https://github.com/damianavila/RISE/issues/594
 */
.reveal pre.xr-text-repr-fallback {
    display: none;
}

#toc-header, .toc-item li {
    margin: auto !important;
    color: #808080 !important;
}

#toc, #toc-wrapper, .toc-item-num, #toc a, .toc {
    margin: auto !important;
    color: #00747b !important;
}

#toc-wrapper {
    top: auto !important;
    bottom: auto !important;
    margin-top: 2rem !important;
    color: #00747b !important;
}


#rise-header {
    margin: 10px;
    left: 5%;
}

#rise-footer {
    margin: 10px;
    right: 5%;
}

#rise-backimage {
    opacity: 0.70;
}

.reveal img {
    max-width: 100%;
}


.md-slide.title {
  position: relative;
  top: -50%;
  margin-left: 5%;
}</style></div></div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="anomaly-detection-via-density-estimation">
<h1>Anomaly Detection via Density Estimation<a class="headerlink" href="#anomaly-detection-via-density-estimation" title="Permalink to this heading">#</a></h1>
<img src="_static/images/aai_presentation_first_slide.svg" alt="Snow" style="width:100%;"><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>


<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">average_precision_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelBinarizer</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KernelDensity</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">tfl_training_anomaly_detection.exercise_tools</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">evaluate</span><span class="p">,</span> 
    <span class="n">get_kdd_data</span><span class="p">,</span> 
    <span class="n">get_house_prices_data</span><span class="p">,</span> 
    <span class="n">create_distributions</span><span class="p">,</span> 
    <span class="n">contamination</span><span class="p">,</span> 
    <span class="n">perform_rkde_experiment</span><span class="p">,</span> 
    <span class="n">get_mnist_data</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tfl_training_anomaly_detection.vae</span> <span class="kn">import</span> <span class="n">VAE</span><span class="p">,</span> <span class="n">build_decoder_mnist</span><span class="p">,</span> <span class="n">build_encoder_minst</span><span class="p">,</span> <span class="n">build_contaminated_minst</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Anomaly Detection via Density Estimation<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p><strong>Idea:</strong> Estimate the density of <span class="math notranslate nohighlight">\(F_0\)</span>. Areas of low density are anomalous.</p>
<ul class="simple">
<li><p>Often <span class="math notranslate nohighlight">\(p\)</span> is too small to estimate complete mixture model</p></li>
<li><p>Takes into account that <span class="math notranslate nohighlight">\(F_1\)</span> might not be well-defined</p></li>
<li><p>Estimation procedure needs to be robust against contamination if no clean training data is available</p></li>
</ul>
<section id="kernel-density-estimation">
<h2>Kernel Density Estimation<a class="headerlink" href="#kernel-density-estimation" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Non-parametric method</p></li>
<li><p>Can represent almost arbitrarily shaped densities</p></li>
<li><p>Each training point “spreads” a fraction of the probability mass as specified by the kernel function</p></li>
</ul>
<p><strong>Definition</strong></p>
<hr class="docutils" />
<img src="_static/images/kernels.png" style="margin:0px 100px" width="600" align="right">
<p><strong>Definition:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(K: \mathbb{R} \to \mathbb{R}\)</span> kernel function</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(K(r) \geq 0\)</span> for all <span class="math notranslate nohighlight">\(r\in \mathbb{R}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\int_{-\infty}^{\infty} K(r) dr = 1\)</span></p></li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(h &gt; 0\)</span> bandwidth</p></li>
<li><p>Bandwidth is the most crucial parameter</p></li>
</ul>
<hr class="docutils" />
<p><strong>Definition:</strong></p>
<hr class="docutils" />
<p>Let <span class="math notranslate nohighlight">\(D = \{x_1,\ldots,x_N\}\subset \mathbb{R}^p\)</span>. The KDE with kernel <span class="math notranslate nohighlight">\(K\)</span> and bandwidth <span class="math notranslate nohighlight">\(h\)</span> is
<span class="math notranslate nohighlight">\(KDE_h(x, D) = \frac{1}{N}\sum_{i=1}^N \frac{1}{h^p}K\left(\frac{|x-x_i|}{h}\right)\)</span></p>
<hr class="docutils" />
<table style="width:60%">
    <tr>
        <td width="20%" style="background-color:#FFFFFF;"><img src="_static/images/bandwidth.png" width="100"></td>
        <td style="background-color:#FFFFFF;"><img src="_static/images/1dkde.png"></td>
    </tr>
    <tr>
        <td style="background-color:#FFFFFF;" colspan="2"><center>Effect of bandwidth and kernel</center></td>
    </tr>
</table><section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h3>
<p>Play with the parameters!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span> <span class="o">=</span> <span class="n">create_distributions</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim_irrelevant</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">sample_train</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Double Blob&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">sample_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/761b8336c226313bd4e78723578750af41d53a18508bda6d3e0d28874598ad63.png" src="_images/761b8336c226313bd4e78723578750af41d53a18508bda6d3e0d28874598ad63.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper function</span>
<span class="k">def</span> <span class="nf">fit_kde</span><span class="p">(</span><span class="n">kernel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">X_train</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KernelDensity</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Fit KDE</span>
<span class="sd">    </span>
<span class="sd">    @param kernel: kernel</span>
<span class="sd">    @param bandwidth: bandwidth</span>
<span class="sd">    @param x_train: data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    <span class="n">kde</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kde</span>

<span class="k">def</span> <span class="nf">visualize_kde</span><span class="p">(</span><span class="n">kde</span><span class="p">:</span> <span class="n">KernelDensity</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">X_test</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">y_test</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot KDE</span>
<span class="sd">    </span>
<span class="sd">    @param kde: KDE</span>
<span class="sd">    @param bandwidth: bandwidth</span>
<span class="sd">    @param X_test: test data</span>
<span class="sd">    @param y_test: test label</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">grid_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">lin</span><span class="p">,</span> <span class="n">lin</span><span class="p">))</span>
    <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lin</span><span class="p">,</span> <span class="n">lin</span><span class="p">)</span>
    <span class="c1"># The score function of sklearn returns log-densities</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">grid_points</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">colormesh</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">colormesh</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Conturs (Bandwidth=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">))</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">y_test</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="choose-kde-parameters">
<h1>Choose KDE Parameters<a class="headerlink" href="#choose-kde-parameters" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ker</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">bdw</span> <span class="o">=</span> <span class="kc">None</span>
<span class="nd">@interact</span><span class="p">(</span>
    <span class="n">kernel</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;tophat&#39;</span><span class="p">,</span> <span class="s1">&#39;epanechnikov&#39;</span><span class="p">,</span> <span class="s1">&#39;exponential&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span>
    <span class="n">bandwidth</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="mf">10.</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">set_kde_params</span><span class="p">(</span><span class="n">kernel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper funtion to set widget parameters</span>
<span class="sd">    </span>
<span class="sd">    @param kernel: kernel</span>
<span class="sd">    @param bandwidth: bandwidth</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">ker</span><span class="p">,</span> <span class="n">bdw</span>

    <span class="n">ker</span> <span class="o">=</span> <span class="n">kernel</span>
    <span class="n">bdw</span> <span class="o">=</span> <span class="n">bandwidth</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "7ee32eccbc394eb695bd3ebae8303e0d"}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kde</span> <span class="o">=</span> <span class="n">fit_kde</span><span class="p">(</span><span class="n">ker</span><span class="p">,</span> <span class="n">bdw</span><span class="p">,</span> <span class="n">X_train</span><span class="p">)</span>
<span class="n">visualize_kde</span><span class="p">(</span><span class="n">kde</span><span class="p">,</span> <span class="n">bdw</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6c003b8ccd6957eae38c533fdbdefdacda017b971ed44fe13cbad9f77a8ceb63.png" src="_images/6c003b8ccd6957eae38c533fdbdefdacda017b971ed44fe13cbad9f77a8ceb63.png" />
</div>
</div>
<section id="bandwidth-selection">
<h2>Bandwidth Selection<a class="headerlink" href="#bandwidth-selection" title="Permalink to this heading">#</a></h2>
<p>The bandwidth is the most important parameter of a KDE model. A wrongly adjusted value will lead to over- or
under-smoothing of the density curve.</p>
<p>A common method to select a bandwidth is maximum log-likelihood cross validation.
$<span class="math notranslate nohighlight">\(h_{\textrm{llcv}} = \arg\max_{h}\frac{1}{k}\sum_{i=1}^k\sum_{y\in D_i}\log\left(\frac{k}{N(k-1)}\sum_{x\in D_{-i}}K_h(x, y)\right)\)</span><span class="math notranslate nohighlight">\(
where \)</span>D_{-i}<span class="math notranslate nohighlight">\( is the data without the \)</span>i<span class="math notranslate nohighlight">\(th cross validation fold \)</span>D_i$.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h1>
<p>ex no.1: Noisy sinusoidal</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate example</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">create_distributions</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">distribution_with_anomalies</span> <span class="o">=</span> <span class="n">contamination</span><span class="p">(</span>
    <span class="n">nominal</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">],</span>
    <span class="n">anomaly</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Blob&#39;</span><span class="p">],</span>
    <span class="n">p</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">)</span>

<span class="c1"># Train data</span>
<span class="n">sample_train</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">sample_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="c1"># Test data</span>
<span class="n">sample_test</span> <span class="o">=</span> <span class="n">distribution_with_anomalies</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">sample_test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">sample_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

<span class="n">scatter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_test</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y_test</span><span class="p">)</span>
<span class="n">handels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">legend_elements</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handels</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Nominal&#39;</span><span class="p">,</span> <span class="s1">&#39;Anomaly&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">distribution_with_anomalies</span> <span class="o">=</span> <span class="n">contamination</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">nominal</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">anomaly</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Blob&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">p</span><span class="o">=</span><span class="mf">0.05</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># Train data</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">sample_train</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">X_train</span> <span class="o">=</span> <span class="n">sample_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># Test data</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/distribution.py:1205,</span> in <span class="ni">Distribution.sample</span><span class="nt">(self, sample_shape, seed, name, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1190</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Generate samples of the specified shape.</span>
<span class="g g-Whitespace">   </span><span class="mi">1191</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1192</span><span class="sd"> Note that a call to `sample()` without arguments will generate a single</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1202</span><span class="sd">   samples: a `Tensor` with prepended dimensions `sample_shape`.</span>
<span class="g g-Whitespace">   </span><span class="mi">1203</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1204</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_and_control_scope</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1205</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_sample_n</span><span class="p">(</span><span class="n">sample_shape</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution.py:956,</span> in <span class="ni">JointDistribution._call_sample_n</span><span class="nt">(self, sample_shape, seed, value, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">955</span> <span class="k">def</span> <span class="nf">_call_sample_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_shape</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">956</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample_n</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">957</span>       <span class="n">sample_shape</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">958</span>       <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">()</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span> <span class="k">else</span> <span class="n">seed</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span>       <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolve_value</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">960</span>                                 <span class="n">allow_partially_specified</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">961</span>                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/internal/distribution_util.py:1350,</span> in <span class="ni">AppendDocstring.__call__.&lt;locals&gt;._fn</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1348</span> <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1349</span> <span class="k">def</span> <span class="nf">_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1350</span>   <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution.py:693,</span> in <span class="ni">JointDistribution._sample_n</span><span class="nt">(self, sample_shape, seed, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">683</span> <span class="nd">@distribution_util</span><span class="o">.</span><span class="n">AppendDocstring</span><span class="p">(</span><span class="n">kwargs_dict</span><span class="o">=</span><span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">684</span>     <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;`Tensor`s structured like `type(model)` used to parameterize &#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">685</span>               <span class="s1">&#39;other dependent (&quot;downstream&quot;) distribution-making functions. &#39;</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span>   <span class="c1"># they&#39;re not already cached. This ensures we don&#39;t try to pass a stateless</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>   <span class="c1"># seed to a stateful sampler, or vice versa.</span>
<span class="ne">--&gt; </span><span class="mi">693</span>   <span class="bp">self</span><span class="o">.</span><span class="n">_get_static_distribution_attributes</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">695</span>   <span class="n">might_have_batch_dims</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">696</span>       <span class="n">distribution_util</span><span class="o">.</span><span class="n">shape_may_be_nontrivial</span><span class="p">(</span><span class="n">sample_shape</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">697</span>       <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">698</span>   <span class="k">if</span> <span class="n">might_have_batch_dims</span><span class="p">:</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution.py:361,</span> in <span class="ni">JointDistribution._get_static_distribution_attributes</span><span class="nt">(self, seed)</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span> <span class="k">def</span> <span class="nf">_get_static_distribution_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_cached_static_attributes&#39;</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">361</span>     <span class="n">flat_list_of_static_attributes</span> <span class="o">=</span> <span class="n">callable_util</span><span class="o">.</span><span class="n">get_output_spec</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span>         <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model</span><span class="p">(</span>  <span class="c1"># pylint: disable=g-long-lambda</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>             <span class="n">sample_and_trace_fn</span><span class="o">=</span><span class="n">trace_static_attributes</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span>             <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">samplers</span><span class="o">.</span><span class="n">zeros_seed</span><span class="p">()))</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_cached_static_attributes</span> <span class="o">=</span> <span class="n">StaticDistributionAttributes</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>         <span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">flat_list_of_static_attributes</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_static_attributes</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/internal/callable_util.py:63,</span> in <span class="ni">get_output_spec</span><span class="nt">(fn, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>   <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="o">.</span><span class="n">from_tensor</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span> <span class="n">arg_specs</span><span class="p">,</span> <span class="n">kwarg_specs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nest</span><span class="o">.</span><span class="n">map_structure</span><span class="p">(</span><span class="n">_as_tensor_spec</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>                                                <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
<span class="ne">---&gt; </span><span class="mi">63</span> <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">autograph</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">get_concrete_function</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="o">*</span><span class="n">arg_specs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg_specs</span><span class="p">)</span><span class="o">.</span><span class="n">structured_outputs</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:1227,</span> in <span class="ni">Function.get_concrete_function</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1225</span> <span class="k">def</span> <span class="nf">get_concrete_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1226</span>   <span class="c1"># Implements PolymorphicFunction.get_concrete_function.</span>
<span class="ne">-&gt; </span><span class="mi">1227</span>   <span class="n">concrete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_concrete_function_garbage_collected</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1228</span>   <span class="n">concrete</span><span class="o">.</span><span class="n">_garbage_collector</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="g g-Whitespace">   </span><span class="mi">1229</span>   <span class="k">return</span> <span class="n">concrete</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:1197,</span> in <span class="ni">Function._get_concrete_function_garbage_collected</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1195</span>   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_creation_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1196</span>     <span class="n">initializers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="ne">-&gt; </span><span class="mi">1197</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">add_initializers_to</span><span class="o">=</span><span class="n">initializers</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1198</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_uninitialized_variables</span><span class="p">(</span><span class="n">initializers</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1200</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_variables</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1201</span>   <span class="c1"># In this case we have created variables on the first call, so we run the</span>
<span class="g g-Whitespace">   </span><span class="mi">1202</span>   <span class="c1"># version which is guaranteed to never create variables.</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:695,</span> in <span class="ni">Function._initialize</span><span class="nt">(self, args, kwds, add_initializers_to)</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_creation_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_scoped_tracing_options</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">691</span>     <span class="n">variable_capturing_scope</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">692</span>     <span class="n">tracing_compilation</span><span class="o">.</span><span class="n">ScopeType</span><span class="o">.</span><span class="n">VARIABLE_CREATION</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">693</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">694</span> <span class="c1"># Force the definition of the function for these arguments</span>
<span class="ne">--&gt; </span><span class="mi">695</span> <span class="bp">self</span><span class="o">.</span><span class="n">_concrete_variable_creation_fn</span> <span class="o">=</span> <span class="n">tracing_compilation</span><span class="o">.</span><span class="n">trace_function</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">696</span>     <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_creation_config</span>
<span class="g g-Whitespace">    </span><span class="mi">697</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">699</span> <span class="k">def</span> <span class="nf">invalid_creator_scope</span><span class="p">(</span><span class="o">*</span><span class="n">unused_args</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwds</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span><span class="w">   </span><span class="sd">&quot;&quot;&quot;Disables variable creation.&quot;&quot;&quot;</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/tracing_compilation.py:178,</span> in <span class="ni">trace_function</span><span class="nt">(args, kwargs, tracing_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>     <span class="n">args</span> <span class="o">=</span> <span class="n">tracing_options</span><span class="o">.</span><span class="n">input_signature</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span>     <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">--&gt; </span><span class="mi">178</span>   <span class="n">concrete_function</span> <span class="o">=</span> <span class="n">_maybe_define_function</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>       <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">tracing_options</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span>   <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">tracing_options</span><span class="o">.</span><span class="n">bind_graph_to_function</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>   <span class="n">concrete_function</span><span class="o">.</span><span class="n">_garbage_collector</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/tracing_compilation.py:283,</span> in <span class="ni">_maybe_define_function</span><span class="nt">(args, kwargs, tracing_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>   <span class="n">target_func_type</span> <span class="o">=</span> <span class="n">lookup_func_type</span>
<span class="ne">--&gt; </span><span class="mi">283</span> <span class="n">concrete_function</span> <span class="o">=</span> <span class="n">_create_concrete_function</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span>     <span class="n">target_func_type</span><span class="p">,</span> <span class="n">lookup_func_context</span><span class="p">,</span> <span class="n">func_graph</span><span class="p">,</span> <span class="n">tracing_options</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">287</span> <span class="k">if</span> <span class="n">tracing_options</span><span class="o">.</span><span class="n">function_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">288</span>   <span class="n">tracing_options</span><span class="o">.</span><span class="n">function_cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">289</span>       <span class="n">concrete_function</span><span class="p">,</span> <span class="n">current_func_context</span>
<span class="g g-Whitespace">    </span><span class="mi">290</span>   <span class="p">)</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/tracing_compilation.py:310,</span> in <span class="ni">_create_concrete_function</span><span class="nt">(function_type, type_context, func_graph, tracing_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span>   <span class="n">placeholder_bound_args</span> <span class="o">=</span> <span class="n">function_type</span><span class="o">.</span><span class="n">placeholder_arguments</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>       <span class="n">placeholder_context</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>   <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="n">disable_acd</span> <span class="o">=</span> <span class="n">tracing_options</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">and</span> <span class="n">tracing_options</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span>     <span class="n">attributes_lib</span><span class="o">.</span><span class="n">DISABLE_ACD</span><span class="p">,</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">310</span> <span class="n">traced_func_graph</span> <span class="o">=</span> <span class="n">func_graph_module</span><span class="o">.</span><span class="n">func_graph_from_py_func</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span>     <span class="n">tracing_options</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span>     <span class="n">tracing_options</span><span class="o">.</span><span class="n">python_function</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">313</span>     <span class="n">placeholder_bound_args</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span>     <span class="n">placeholder_bound_args</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span>     <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span>     <span class="n">func_graph</span><span class="o">=</span><span class="n">func_graph</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span>     <span class="n">add_control_dependencies</span><span class="o">=</span><span class="ow">not</span> <span class="n">disable_acd</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span>     <span class="n">arg_names</span><span class="o">=</span><span class="n">function_type_utils</span><span class="o">.</span><span class="n">to_arg_names</span><span class="p">(</span><span class="n">function_type</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>     <span class="n">create_placeholders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">320</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span> <span class="n">transform</span><span class="o">.</span><span class="n">apply_func_graph_transforms</span><span class="p">(</span><span class="n">traced_func_graph</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span> <span class="n">graph_capture_container</span> <span class="o">=</span> <span class="n">traced_func_graph</span><span class="o">.</span><span class="n">function_captures</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/framework/func_graph.py:1059,</span> in <span class="ni">func_graph_from_py_func</span><span class="nt">(name, python_func, args, kwargs, signature, func_graph, add_control_dependencies, arg_names, op_return_value, collections, capture_by_value, create_placeholders)</span>
<span class="g g-Whitespace">   </span><span class="mi">1056</span>   <span class="k">return</span> <span class="n">x</span>
<span class="g g-Whitespace">   </span><span class="mi">1058</span> <span class="n">_</span><span class="p">,</span> <span class="n">original_func</span> <span class="o">=</span> <span class="n">tf_decorator</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">python_func</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1059</span> <span class="n">func_outputs</span> <span class="o">=</span> <span class="n">python_func</span><span class="p">(</span><span class="o">*</span><span class="n">func_args</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1061</span> <span class="c1"># invariant: `func_outputs` contains only Tensors, CompositeTensors,</span>
<span class="g g-Whitespace">   </span><span class="mi">1062</span> <span class="c1"># TensorArrays and `None`s.</span>
<span class="g g-Whitespace">   </span><span class="mi">1063</span> <span class="n">func_outputs</span> <span class="o">=</span> <span class="n">variable_utils</span><span class="o">.</span><span class="n">convert_variables_to_tensors</span><span class="p">(</span><span class="n">func_outputs</span><span class="p">)</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:598,</span> in <span class="ni">Function._generate_scoped_tracing_options.&lt;locals&gt;.wrapped_fn</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span> <span class="k">with</span> <span class="n">default_graph</span><span class="o">.</span><span class="n">_variable_creator_scope</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="g g-Whitespace">    </span><span class="mi">595</span>   <span class="c1"># __wrapped__ allows AutoGraph to swap in a converted function. We give</span>
<span class="g g-Whitespace">    </span><span class="mi">596</span>   <span class="c1"># the function a weak reference to itself to avoid a reference cycle.</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span>   <span class="k">with</span> <span class="n">OptionalXlaContext</span><span class="p">(</span><span class="n">compile_with_xla</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">598</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">weak_wrapped_fn</span><span class="p">()</span><span class="o">.</span><span class="n">__wrapped__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span>   <span class="k">return</span> <span class="n">out</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution.py:362,</span> in <span class="ni">JointDistribution._get_static_distribution_attributes.&lt;locals&gt;.&lt;lambda&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span> <span class="k">def</span> <span class="nf">_get_static_distribution_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_cached_static_attributes&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="n">flat_list_of_static_attributes</span> <span class="o">=</span> <span class="n">callable_util</span><span class="o">.</span><span class="n">get_output_spec</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">362</span>         <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model</span><span class="p">(</span>  <span class="c1"># pylint: disable=g-long-lambda</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>             <span class="n">sample_and_trace_fn</span><span class="o">=</span><span class="n">trace_static_attributes</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span>             <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">samplers</span><span class="o">.</span><span class="n">zeros_seed</span><span class="p">()))</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_cached_static_attributes</span> <span class="o">=</span> <span class="n">StaticDistributionAttributes</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>         <span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">flat_list_of_static_attributes</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_static_attributes</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution.py:1047,</span> in <span class="ni">JointDistribution._execute_model</span><span class="nt">(self, sample_shape, seed, value, stop_index, sample_and_trace_fn)</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span>     <span class="k">if</span> <span class="n">stop_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="n">stop_index</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1046</span>       <span class="k">break</span>
<span class="ne">-&gt; </span><span class="mi">1047</span>     <span class="n">d</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">next_value</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1048</span> <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1049</span>   <span class="k">pass</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution_sequential.py:399,</span> in <span class="ni">_JointDistributionSequential._model_coroutine</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span> <span class="k">for</span> <span class="n">dist_fn</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dist_fn_wrapped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dist_fn_args</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">399</span>   <span class="n">dist</span> <span class="o">=</span> <span class="n">dist_fn</span><span class="p">(</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>   <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">401</span>     <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Root</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow_probability/python/distributions/joint_distribution_sequential.py:610,</span> in <span class="ni">_unify_call_signature.&lt;locals&gt;.dist_fn_wrapped</span><span class="nt">(*xs)</span>
<span class="g g-Whitespace">    </span><span class="mi">605</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">606</span>   <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span>       <span class="s1">&#39;Internal Error: Too few inputs provided to </span><span class="si">{}</span><span class="s1">-th distribution maker &#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>       <span class="s1">&#39;(dist_fn: </span><span class="si">{}</span><span class="s1">, expected: </span><span class="si">{}</span><span class="s1">, saw: </span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span>           <span class="n">i</span><span class="p">,</span> <span class="n">dist_fn</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)))</span>
<span class="ne">--&gt; </span><span class="mi">610</span> <span class="k">return</span> <span class="n">dist_fn</span><span class="p">(</span><span class="o">*</span><span class="nb">reversed</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]))</span>

<span class="nn">File ~/code/tfl-training-practical-anomaly-detection/src/tfl_training_anomaly_detection/exercise_tools.py:361,</span> in <span class="ni">create_distributions.&lt;locals&gt;.&lt;lambda&gt;</span><span class="nt">(n, u)</span>
<span class="g g-Whitespace">    </span><span class="mi">336</span>     <span class="n">sinusoidal</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">JointDistributionSequential</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">337</span>         <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span>             <span class="n">tfd</span><span class="o">.</span><span class="n">Independent</span><span class="p">(</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">349</span>         <span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">350</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="n">sinusoidal</span> <span class="o">=</span> <span class="n">tfd</span><span class="o">.</span><span class="n">JointDistributionSequential</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">354</span>         <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span>             <span class="n">tfd</span><span class="o">.</span><span class="n">Independent</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>                 <span class="n">tfd</span><span class="o">.</span><span class="n">Uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">high</span><span class="o">=</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>             <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span>             <span class="n">tfd</span><span class="o">.</span><span class="n">MultivariateNormalDiag</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span>                 <span class="n">loc</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span><span class="p">,</span> <span class="n">scale_diag</span><span class="o">=</span><span class="p">[</span><span class="n">thickness_sinusoidal</span><span class="p">]</span> <span class="o">*</span> <span class="n">dim</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span>             <span class="p">),</span>
<span class="ne">--&gt; </span><span class="mi">361</span>             <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">tfd</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="n">create_point</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">)),</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span>         <span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span> <span class="n">distributions</span><span class="p">[</span><span class="s2">&quot;Sinusoidal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinusoidal</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span> <span class="c1">#</span>
<span class="g g-Whitespace">    </span><span class="mi">367</span> <span class="c1"># Random Gaussian Mixture</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span> <span class="c1">#</span>

<span class="nn">File ~/code/tfl-training-practical-anomaly-detection/src/tfl_training_anomaly_detection/exercise_tools.py:324,</span> in <span class="ni">create_distributions.&lt;locals&gt;.create_point</span><span class="nt">(x, epsilon)</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span> <span class="k">def</span> <span class="nf">create_point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span><span class="sd">     Helper function that creates points on the sinusoidal shape</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">318</span><span class="sd">     :param x: point description</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span><span class="sd">     :param epsilon: noise to be added</span>
<span class="g g-Whitespace">    </span><span class="mi">320</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span>         <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span>             <span class="p">[</span>
<span class="ne">--&gt; </span><span class="mi">324</span>                 <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>                 <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>                     <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="n">epsilon</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>                     <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>                 <span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>             <span class="p">],</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>             <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span>     <span class="k">return</span> <span class="n">res</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/util/traceback_utils.py:153,</span> in <span class="ni">filter_traceback.&lt;locals&gt;.error_handler</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>   <span class="n">filtered_tb</span> <span class="o">=</span> <span class="n">_process_traceback_frames</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">153</span>   <span class="k">raise</span> <span class="n">e</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">filtered_tb</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span>   <span class="k">del</span> <span class="n">filtered_tb</span>

<span class="nn">File /opt/homebrew/Caskroom/miniconda/base/envs/tfl-training-ad/lib/python3.10/site-packages/tensorflow/python/framework/ops.py:1020,</span> in <span class="ni">_create_c_op</span><span class="nt">(graph, node_def, inputs, control_inputs, op_def, extract_traceback)</span>
<span class="g g-Whitespace">   </span><span class="mi">1017</span>   <span class="n">c_op</span> <span class="o">=</span> <span class="n">pywrap_tf_session</span><span class="o">.</span><span class="n">TF_FinishOperation</span><span class="p">(</span><span class="n">op_desc</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1018</span> <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">InvalidArgumentError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1019</span>   <span class="c1"># Convert to ValueError for backwards compatibility.</span>
<span class="ne">-&gt; </span><span class="mi">1020</span>   <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span> <span class="c1"># Record the current Python stack trace as the creating stacktrace of this</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="c1"># TF_Operation.</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="k">if</span> <span class="n">extract_traceback</span><span class="p">:</span>

<span class="ne">ValueError</span>: Index out of range using input dim 1; input has only 1 dims for &#39;{{node strided_slice}} = StridedSlice[Index=DT_INT32, T=DT_FLOAT, begin_mask=3, ellipsis_mask=0, end_mask=1, new_axis_mask=0, shrink_axis_mask=0](MultivariateNormalDiag/sample/chain_of_shift_of_scale_matvec_linear_operator/forward/shift/forward/add, strided_slice/stack, strided_slice/stack_1, strided_slice/stack_2)&#39; with input shapes: [2], [2], [2], [2] and with computed input tensors: input[3] = &lt;1 1&gt;.
</pre></div>
</div>
</div>
</div>
<section id="exercise-define-the-search-space-for-the-kernel-and-the-bandwidth">
<h2>Exercise: Define the search space for the kernel and the bandwidth<a class="headerlink" href="#exercise-define-the-search-space-for-the-kernel-and-the-bandwidth" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;tophat&#39;</span><span class="p">,</span> <span class="s1">&#39;epanechnikov&#39;</span><span class="p">,</span> <span class="s1">&#39;exponential&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span> <span class="c1"># Add available kernels</span>
    <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="c1"># Define Search space for bandwidth parameter</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hyperopt_by_score</span><span class="p">(</span><span class="n">X_train</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">param_space</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs hyperoptimization by score</span>
<span class="sd">    </span>
<span class="sd">    @param X_train: data</span>
<span class="sd">    @param param_space: parameter space</span>
<span class="sd">    @param cv: number of cv folds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">KernelDensity</span><span class="p">()</span>

    <span class="n">search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">kde</span><span class="p">,</span>
        <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_space</span><span class="p">,</span>
        <span class="n">n_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># use estimators internal scoring function, i.e. the log-probability of the validation set for KDE</span>
    <span class="p">)</span>

    <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">search</span><span class="o">.</span><span class="n">best_estimator_</span>
</pre></div>
</div>
</div>
</div>
<p>Run the code below to perform hyperparameter optimization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">hyperopt_by_score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">param_space</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best parameters:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

<span class="n">test_scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test_scores</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">test_scores</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">test_scores</span><span class="p">)])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_scores</span><span class="p">)</span>

<span class="n">curves</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualize_kde</span><span class="p">(</span><span class="n">kde</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">],</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-isolate-anomalies-in-house-prices">
<h2>Exercise: Isolate anomalies in house prices<a class="headerlink" href="#exercise-isolate-anomalies-in-house-prices" title="Permalink to this heading">#</a></h2>
<p>You are a company resposible to estimate house prices around Ames, Iowa, specifically around college area. But there is a problem: houses from a nearby area, ‘Veenker’, are often included in your dataset. You want to build an anomaly detection algorithm that filters one by one every point that comes from the wrong neighborhood. You have been able to isolate an X_train dataset which, you are sure, contains only houses from College area. Following the previous example, test your ability to isolate anomalies in new incoming data (X_test) with KDE.</p>
<p>Advanced exercise:
What happens if the contamination comes from other areas? You can choose among the following names:</p>
<p>OldTown, Veenker, Edwards, MeadowV, Somerst, NPkVill, BrDale, Gilbert, NridgHt, Sawyer, Blmngtn, Blueste</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">get_house_prices_data</span><span class="p">(</span><span class="n">neighborhood</span> <span class="o">=</span> <span class="s1">&#39;CollgCr&#39;</span><span class="p">,</span> <span class="n">anomaly_neighborhood</span><span class="o">=</span><span class="s1">&#39;Veenker&#39;</span><span class="p">)</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total data</span>
<span class="n">train_test_data</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_test</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">train_test_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;LotArea&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;OverallCond&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">y_total</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># When data are highly in-homogeneous, like in this case, it is often beneficial </span>
<span class="c1"># to rescale them before applying any anomaly detection or clustering technique.</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">X_train_rescaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;tophat&#39;</span><span class="p">,</span> <span class="s1">&#39;epanechnikov&#39;</span><span class="p">,</span> <span class="s1">&#39;exponential&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span> <span class="c1"># Add available kernels</span>
    <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="c1"># Define Search space for bandwidth parameter</span>
<span class="p">}</span>
<span class="n">params</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">hyperopt_by_score</span><span class="p">(</span><span class="n">X_train_rescaled</span><span class="p">,</span> <span class="n">param_space</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best parameters:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

<span class="n">X_test_rescaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test_rescaled</span><span class="p">)</span>
<span class="n">test_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test_scores</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">test_scores</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">test_scores</span><span class="p">)])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_scores</span><span class="p">)</span>
<span class="n">curves</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-curse-of-dimensionality">
<h2>The Curse of Dimensionality<a class="headerlink" href="#the-curse-of-dimensionality" title="Permalink to this heading">#</a></h2>
<p>The flexibility of KDE comes at a price. The dependency on the dimensionality of the data is quite unfavorable.</p>
<p><em>Theorem</em> [Stone, 1982]
Any estimator that is consistent<span class="math notranslate nohighlight">\(^*\)</span> with the class of all <span class="math notranslate nohighlight">\(k\)</span>-fold differentiable pdfs over <span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span> has a
convergence rate of at most</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{n^{\frac{k}{2k+d}}}
\]</div>
<p><span class="math notranslate nohighlight">\(^*\)</span>Consistency = for all pdfs <span class="math notranslate nohighlight">\(p\)</span> in the class: <span class="math notranslate nohighlight">\(\lim_{n\to\infty}|KDE_h(x, D) - p(x)|_\infty = 0\)</span> with probability <span class="math notranslate nohighlight">\(1\)</span>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id2">
<h1>Exercise<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>The very slow convergence in high dimensions does not necessary mean that we will see bad results in high dimensional anomaly detection with KDE.</p></li>
<li><p>Especially if the anomalies are very outlying.</p></li>
<li><p>However, in cases where contours of the nominal distribution are non-convex we can run into problems.</p></li>
</ul>
<p>We take a look at a higher dimensional version of out previous data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dists</span> <span class="o">=</span> <span class="n">create_distributions</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">distribution_with_anomalies</span> <span class="o">=</span> <span class="n">contamination</span><span class="p">(</span>
    <span class="n">nominal</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">],</span>
    <span class="n">anomaly</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Blob&#39;</span><span class="p">],</span>
    <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span>
<span class="p">)</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">distribution_with_anomalies</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter_3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit KDE on high dimensional examples </span>
<span class="n">rocs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">auprs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bandwidths</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">param_space</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">],</span>
        <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="c1"># Define Search space for bandwidth parameter</span>
    <span class="p">}</span>

<span class="n">kdes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">dims</span><span class="p">):</span>
    <span class="c1"># Generate d dimensional distributions</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="n">create_distributions</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>

    <span class="n">distribution_with_anomalies</span> <span class="o">=</span> <span class="n">contamination</span><span class="p">(</span>
        <span class="n">nominal</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">],</span>
        <span class="n">anomaly</span><span class="o">=</span><span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Blob&#39;</span><span class="p">],</span>
        <span class="n">p</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="c1"># Train on clean data</span>
    <span class="n">sample_train</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="s1">&#39;Sinusoidal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">sample_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="c1"># Test data</span>
    <span class="n">sample_test</span> <span class="o">=</span> <span class="n">distribution_with_anomalies</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">sample_test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">sample_test</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="c1"># Optimize bandwidth</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">hyperopt_by_score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">param_space</span><span class="p">)</span>
    <span class="n">kdes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">kde</span><span class="p">)</span>
    
    <span class="n">bandwidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;bandwidth&#39;</span><span class="p">])</span>

    <span class="n">test_scores</span> <span class="o">=</span> <span class="o">-</span><span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">test_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test_scores</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">test_scores</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">test_scores</span><span class="p">)])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_scores</span><span class="p">)</span>

    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot cross section of pdf </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">kdes</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))):</span>
    
    <span class="n">params</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">kdes</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>

    <span class="n">lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">grid_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="n">lin</span><span class="p">,</span> <span class="n">lin</span><span class="p">))</span>
    <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lin</span><span class="p">,</span> <span class="n">lin</span><span class="p">)</span>
    <span class="c1"># The score function of sklearn returns log-densities</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kde</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">grid_points</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">colormesh</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Dim = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="n">axis</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    

<span class="c1"># Plot evaluation</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Crossection of the KDE at (0,...,0, x, y)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="robustness">
<h2>Robustness<a class="headerlink" href="#robustness" title="Permalink to this heading">#</a></h2>
<p>Another drawback of KDE in the context of anomaly detection is that it is not robust against contamination of the data</p>
<p><strong>Definition</strong>
The <em>breakdown point</em> of an estimator is the smallest fraction of observations that need to be changed so that we can
move the estimate arbitrarily far away from the true value.</p>
<p><strong>Example</strong>: The sample mean has a breakdown point of <span class="math notranslate nohighlight">\(0\)</span>. Indeed, for a sample of <span class="math notranslate nohighlight">\(x_1,\ldots, x_n\)</span> we only need to
change a single value in order to move the sample mean in any way we want. That means that the breakdown point is
smaller than <span class="math notranslate nohighlight">\(\frac{1}{n}\)</span> for every <span class="math notranslate nohighlight">\(n\in\mathbb{N}\)</span>.</p>
</section>
<section id="robust-statistics">
<h2>Robust Statistics<a class="headerlink" href="#robust-statistics" title="Permalink to this heading">#</a></h2>
<p>There are robust replacements for the sample mean:</p>
<ul class="simple">
<li><p>Median of means: Split the dataset into <span class="math notranslate nohighlight">\(S\)</span> equally sized subsets <span class="math notranslate nohighlight">\(X_1,\ldots, X_S\)</span> and compute
<span class="math notranslate nohighlight">\(\mathrm{median}(\overline{X_1},\ldots, \overline{X_S})\)</span></p></li>
<li><p>M-estimation: The mean in a normed vector space is the value that minimizes the squared distances</p></li>
</ul>
<center>
$\overline{X} = \min_{y}\sum_{x\in X}|x-y|^2$
</center>
M-estimation replaces the quadratic loss with a more robust loss function.<section id="huber-loss">
<h3>Huber loss<a class="headerlink" href="#huber-loss" title="Permalink to this heading">#</a></h3>
<p>Switch from quadratic to linear loss at prescribed threshold</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">huber</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Huber loss</span>
<span class="sd">    </span>
<span class="sd">    @param error: base error</span>
<span class="sd">    @param threshold: threshold for linear transition</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">test</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">test</span><span class="p">)</span><span class="o">*</span><span class="n">threshold</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">-</span> <span class="n">threshold</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">huber</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Huber Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hampel-loss">
<h3>Hampel loss<a class="headerlink" href="#hampel-loss" title="Permalink to this heading">#</a></h3>
<p>More complex loss function. Depends on 3 parameters 0 &lt; a &lt; b&lt; r</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">single_point_hampel</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hampel loss</span>
<span class="sd">    </span>
<span class="sd">    @param error: base error</span>
<span class="sd">    @param a: 1st threshold parameter</span>
<span class="sd">    @param b: 2nd threshold parameter</span>
<span class="sd">    @param r: 3rd threshold parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a</span><span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="o">-</span><span class="n">a</span><span class="p">))</span>
    <span class="k">elif</span>  <span class="n">b</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="o">+</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">b</span><span class="p">)))</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="o">+</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="n">hampel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">single_point_hampel</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">10.1</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">hampel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Hampel Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="kde-is-a-mean">
<h2>KDE is a Mean<a class="headerlink" href="#kde-is-a-mean" title="Permalink to this heading">#</a></h2>
<img src="_static/images/kernels.png" align="right" width="400" style="margin: 150px 75px">
<p><strong>Kernel as scalar product:</strong></p>
<ul class="simple">
<li><p>Let <span class="math notranslate nohighlight">\(K\)</span> be a radial monotonic<span class="math notranslate nohighlight">\(^\ast\)</span> kernel over <span class="math notranslate nohighlight">\(\mathbb{R}^n\)</span>.</p></li>
<li><p>For <span class="math notranslate nohighlight">\(x\in\mathbb{R}^n\)</span> let <span class="math notranslate nohighlight">\(\phi_x = K(\cdot, x)\)</span>.</p></li>
<li><p>Vector space over the linear span of <span class="math notranslate nohighlight">\(\{\phi_x \mid x\in\mathbb{R}^n\}\)</span>:</p>
<ul>
<li><p>Pointwise addition and scalar multiplication.</p></li>
</ul>
</li>
<li><p>Define the scalar product <span class="math notranslate nohighlight">\(\langle \phi_x, \phi_y\rangle = K(x,y)\)</span>.</p></li>
<li><p>Advantage: Scalar product is computable</p></li>
<li><p>Call this the reproducing kernel Hilbert space (RKHS) of <span class="math notranslate nohighlight">\(K\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathrm{KDE}_h(\cdot, D) = \frac{1}{N}\sum_{i=1}^N K_h(\cdot, x_i) = \frac{1}{N}\sum_{i=1}^N\phi_{x_i}\)</span></p>
<ul>
<li><p>where <span class="math notranslate nohighlight">\(K_h(x,y) = \frac{1}{h}K\left(\frac{|x-y|}{h}\right)\)</span></p></li>
</ul>
</li>
</ul>
<p><span class="math notranslate nohighlight">\(^*\)</span>All kernels that we have seen are radial and monotonic</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id3">
<h1>Exercise<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h1>
<p>We compare the performance of different approaches to recover the nominal distribution under contamination.
Here, we use code by <a class="reference external" href="https://github.com/lminvielle/mom-kde">Humbert et al.</a> to replicate
the results in the referenced paper on median-of-mean KDE. More details on rKDE can instead be found in this paper by <a class="reference external" href="https://arxiv.org/abs/1107.3133#:~:text=We%20propose%20a%20method%20for,ideas%20from%20classical%20M%2Destimation.">Kim and Scott.</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =======================================================</span>
<span class="c1">#   Parameters</span>
<span class="c1"># =======================================================</span>
<span class="n">algos</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;kde&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mom-kde&#39;</span><span class="p">,</span> <span class="c1"># Median-of-Means</span>
    <span class="s1">&#39;rkde-huber&#39;</span><span class="p">,</span> <span class="c1"># robust KDE with huber loss</span>
    <span class="s1">&#39;rkde-hampel&#39;</span><span class="p">,</span> <span class="c1"># robust KDE with hampel loss</span>
<span class="p">]</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="s1">&#39;house-prices&#39;</span>
<span class="n">dataset_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;neighborhood&#39;</span><span class="p">:</span> <span class="s1">&#39;CollgCr&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly_neighborhood&#39;</span><span class="p">:</span> <span class="s1">&#39;Edwards&#39;</span><span class="p">}</span>

<span class="n">outlierprop_range</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">kernel</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">auc_scores</span> <span class="o">=</span> <span class="n">perform_rkde_experiment</span><span class="p">(</span>
    <span class="n">algos</span><span class="p">,</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">dataset_options</span><span class="p">,</span>
    <span class="n">outlierprop_range</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">algo</span><span class="p">,</span> <span class="n">algo_data</span> <span class="ow">in</span> <span class="n">auc_scores</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;algo&#39;</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">algo_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;outlier_prop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">algo_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;outlier_prop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="s1">&#39;auc_anomaly&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;outlier_prop&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;auc_score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Comparison of rKDE against contamination&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Try using different neighborhoods for contamination. Which robust KDE algorithm performs better overall? Choose among the following options:</p>
<p>OldTown, Veenker, Edwards, MeadowV, Somerst, NPkVill, BrDale, Gilbert, NridgHt, Sawyer, Blmngtn, Blueste</p>
<p>You can also change the kernel type: gaussian, tophat, epechenikov, exponential, linear or cosine,</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>Kernel density estimation is a non-parametric method to estimate a pdf from a sample.</p></li>
<li><p>Bandwidth is the most important parameter.</p></li>
<li><p>Converges to the true pdf if <span class="math notranslate nohighlight">\(n\to\infty\)</span>.</p>
<ul>
<li><p>Convergence exponentially depends on the dimension.</p></li>
</ul>
</li>
<li><p>KDE is sensitive to contamination:</p>
<ul>
<li><p>In a contaminated setting one can employ methods from robust statistics to obtain robust estimates.</p></li>
</ul>
</li>
</ul>
<section id="implementations">
<h2>Implementations<a class="headerlink" href="#implementations" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Sklearn: <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KernelDensity.html#sklearn.neighbors.KernelDensity">sklearn.neighbors.KernelDensity</a></p></li>
<li><p>Statsmodels: <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.nonparametric.kernel_density.KDEMultivariate.html">statsmodels.nonparametric.kernel_density.KDEMultivariate</a></p></li>
<li><p>FastKDE: <a class="reference external" href="https://pypi.org/project/fastkde/">link</a>, offers automatic bandwidth and kernel selection.</p></li>
</ul>
<img src="_static/images/aai_presentation_last_slide.svg" alt="Snow" style="width:100%;"></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="nb_01_1_intro_and_ad_taxonomy.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Taxonomy of Anomaly Detection Approaches</p>
      </div>
    </a>
    <a class="right-next"
       href="nb_03_anomaly_detection_via_isolation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Anomaly Detection via Isolation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Anomaly Detection via Density Estimation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Anomaly Detection via Density Estimation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kernel-density-estimation">Kernel Density Estimation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-kde-parameters">Choose KDE Parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bandwidth-selection">Bandwidth Selection</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-define-the-search-space-for-the-kernel-and-the-bandwidth">Exercise: Define the search space for the kernel and the bandwidth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-isolate-anomalies-in-house-prices">Exercise: Isolate anomalies in house prices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solution">Solution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-curse-of-dimensionality">The Curse of Dimensionality</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Exercise</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robustness">Robustness</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-statistics">Robust Statistics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#huber-loss">Huber loss</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hampel-loss">Hampel loss</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#kde-is-a-mean">KDE is a Mean</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Exercise</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementations">Implementations</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By appliedAI TransferLab
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>